<main class="register-page">
  <div class="register-container">
    <section class="register-visual">
      <div aria-label="University branding" class="branding" role="img"></div>
    </section>

    <section class="register-form">
      <div class="form-container">
        <header class="form-header">
          <h1>Register an account</h1>
          <p>Already have an account? <a routerLink="/login">Log in</a></p>
        </header>

        <div class="form-content">
          <form (ngSubmit)="onSubmit()" [formGroup]="registerForm" novalidate>

            <!-- Nome e Sobrenome -->
            <div class="form-group form-row">
              <div class="input-wrapper">
                <label class="sr-only" for="firstName">First Name</label>
                <input
                  [class.error]="isFieldInvalid('firstName')"
                  autocomplete="given-name"
                  formControlName="firstName"
                  id="firstName"
                  placeholder="First Name"
                  type="text">
                <div *ngIf="isFieldInvalid('firstName')" class="error-tooltip">
                  {{ getFieldError('firstName') }}
                </div>
              </div>

              <div class="input-wrapper">
                <label class="sr-only" for="lastName">Last Name</label>
                <input
                  [class.error]="isFieldInvalid('lastName')"
                  autocomplete="family-name"
                  formControlName="lastName"
                  id="lastName"
                  placeholder="Last Name"
                  type="text">
                <div *ngIf="isFieldInvalid('lastName')" class="error-tooltip">
                  {{ getFieldError('lastName') }}
                </div>
              </div>
            </div>

            <!-- Universidade -->
            <div class="form-group form-row">
              <div class="input-wrapper">
                <label class="sr-only" for="university">University</label>
                <select
                  [class.error]="isFieldInvalid('university')"
                  [disabled]="isLoadingUniversities"
                  formControlName="university"
                  id="university">

                  <option disabled selected value="">
                    {{ isLoadingUniversities ? 'Carregando universidades...' : 'Selecione sua universidade' }}
                  </option>

                  <!-- OpÃ§Ã£o para nÃ£o ter universidade -->
                  <option value="none">ðŸš« NÃ£o sou de nenhuma universidade</option>

                  <!-- Universidades dinÃ¢micas do backend -->
                  <option *ngFor="let university of universities" [value]="university.id">
                    {{ university.name }} ({{ university.acronym }})
                    <span *ngIf="university.city && university.state"> - {{ university.city }}
                      /{{ university.state }}</span>
                  </option>
                </select>

                <div *ngIf="isFieldInvalid('university')" class="error-tooltip">
                  {{ getFieldError('university') }}
                </div>
              </div>
            </div>

            <!-- Campos individuais -->
            <div class="form-group full-width">
              <div class="input-wrapper">
                <label class="sr-only" for="email">Email</label>
                <input
                  [class.error]="isFieldInvalid('email')"
                  autocomplete="email"
                  formControlName="email"
                  id="email"
                  placeholder="Email"
                  type="email">
                <div *ngIf="isFieldInvalid('email')" class="error-tooltip">
                  {{ getFieldError('email') }}
                </div>
              </div>
            </div>

            <div class="form-group full-width">
              <div class="input-wrapper">
                <label class="sr-only" for="telephone">Telephone</label>
                <input
                  [class.error]="isFieldInvalid('telephone')"
                  autocomplete="tel"
                  formControlName="telephone"
                  id="telephone"
                  placeholder="Telephone"
                  type="tel">
                <div *ngIf="isFieldInvalid('telephone')" class="error-tooltip">
                  {{ getFieldError('telephone') }}
                </div>
              </div>
            </div>

            <div class="form-group full-width">
              <div class="input-wrapper">
                <label class="sr-only" for="password">Password</label>
                <input
                  [class.error]="isFieldInvalid('password')"
                  autocomplete="new-password"
                  formControlName="password"
                  id="password"
                  placeholder="Enter your password"
                  type="password">
                <div *ngIf="isFieldInvalid('password')" class="error-tooltip">
                  {{ getFieldError('password') }}
                </div>
              </div>
            </div>

            <div class="form-group full-width">
              <div class="input-wrapper">
                <label class="sr-only" for="confirmPassword">Confirm Password</label>
                <input
                  [class.error]="isFieldInvalid('confirmPassword') || registerForm.errors?.['passwordMismatch']"
                  autocomplete="new-password"
                  formControlName="confirmPassword"
                  id="confirmPassword"
                  placeholder="Confirm your password"
                  type="password">
                <div *ngIf="isFieldInvalid('confirmPassword') || registerForm.errors?.['passwordMismatch']"
                     class="error-tooltip">
                  {{ getFieldError('confirmPassword') }}
                </div>
              </div>
            </div>

            <!-- Terms -->
            <div class="check-terms">
              <div class="input-wrapper checkbox-wrapper">
                <input
                  formControlName="acceptTerms"
                  id="acceptTerms"
                  type="checkbox">
                <label for="acceptTerms">
                  I agree to the <a rel="noopener" routerLink="/terms" target="_blank">Terms & Conditions</a>
                </label>
                <div *ngIf="isFieldInvalid('acceptTerms')" class="error-tooltip">
                  {{ getFieldError('acceptTerms') }}
                </div>
              </div>
            </div>

            <div *ngIf="errorMessage" class="server-error-message">
              {{ errorMessage }}
            </div>

            <button
              [attr.aria-label]="isLoading ? 'Creating account, please wait' : 'Create account'"
              [class.loading]="isLoading"
              [disabled]="registerForm.invalid || isLoading || isLoadingUniversities"
              type="submit">
              {{ isLoading ? 'Creating account...' : 'Create account' }}
            </button>
          </form>

          <!-- Social buttons -->
          <div class="divider">
            <span>Or register with</span>
          </div>

          <div class="social-buttons">
            <button
              (click)="signUpWithGoogle()"
              [disabled]="isLoading"
              aria-label="Sign up with Google"
              class="google-btn"
              type="button">
              <i aria-hidden="true" class="fa-brands fa-google"></i>
              Google
            </button>
            <button
              (click)="signUpWithApple()"
              [disabled]="isLoading"
              aria-label="Sign up with Apple"
              class="apple-btn"
              type="button">
              <i aria-hidden="true" class="fa-brands fa-apple"></i>
              Apple
            </button>
          </div>
        </div>
      </div>
    </section>
  </div>

  <app-photo-upload-modal
    (modalClosed)="onPhotoModalClosed()"
    (photoSelected)="onPhotoSelected($event)"
    [isProcessing]="isLoading"
    [isVisible]="showPhotoModal">
  </app-photo-upload-modal>
</main>
